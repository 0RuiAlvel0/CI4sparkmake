#!/bin/bash
# Save this as spark-make and make it executable: chmod +x spark-make

TYPE="$1"
NAME="$2"

if [ -z "$TYPE" ] || [ -z "$NAME" ]; then
    echo "Usage: spark-make [controller|model|seeder|migration|command|filter|helper|library] Name"
    echo "No need for extension, just the name. For helpers, do not include _helper."
    exit 1
fi

if [[ ! "$TYPE" =~ ^(controller|model|seeder|migration|command|filter|helper|library)$ ]]; then
    echo "Invalid type. Must be one of: controller, model, seeder, migration, command, filter, helper, library"
    exit 1
fi

# If anything other then helper is requested, use spark make command
if [[ "$TYPE" != "helper" && "$TYPE" != "library" ]]; then
    php spark make:$TYPE "$NAME"
    # Convert first letter to uppercase for filename
    FILE_NAME="$(tr '[:lower:]' '[:upper:]' <<< ${NAME:0:1})${NAME:1}.php"
else
    # For helper, just open the file directly
    FILE_NAME="${NAME}_helper.php"
fi

case "$TYPE" in
    seeder)
        FILE="app/Database/Seeds/$FILE_NAME"
        ;;
    migration)
        # Find the migration file (timestamp prefix)
        FILE=$(ls app/Database/Migrations/*"${FILE_NAME}" 2>/dev/null | head -n 1)
        ;;
    model)
        FILE="app/Models/$FILE_NAME"
        ;;
    controller)
        FILE="app/Controllers/$FILE_NAME"
        ;;
    filter)
        FILE="app/Filters/$FILE_NAME"
        ;;
    command)
        FILE="app/Commands/$FILE_NAME"
        ;;
    helper)
        FILE="app/Helpers/$FILE_NAME"
        touch "$FILE"  # Create the helper file
        ;;
    library)
        FILE="app/Libraries/$FILE_NAME"
        touch "$FILE"  # Create the library file
        #Add basic class structure
        CLASS_NAME="$(tr '[:lower:]' '[:upper:]' <<< ${NAME:0:1})${NAME:1}"
        echo "<?php 
namespace App\Libraries;

class $CLASS_NAME
{
    public function __construct()
    {
        // Constructor code here
    }
}
" > "$FILE"
        ;;
    *)
        FILE=""
        ;;
esac

if [ -n "$FILE" ] && [ -f "$FILE" ]; then
    code "$FILE"
else
    echo "File $FILE not found."
fi